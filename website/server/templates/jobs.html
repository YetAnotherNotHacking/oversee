{% extends "base.html" %}

{% block title %}Jobs - Oversee Scanner{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="h2 mb-4">Jobs</h1>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped" id="jobsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>CIDR Block</th>
                            <th>Ports</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Created</th>
                            <th>Assigned To</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for job in jobs %}
                        <tr>
                            <td>{{ job.id }}</td>
                            <td>{{ job.cidr_block }}</td>
                            <td>{{ job.ports }}</td>
                            <td>
                                <span class="badge {% if job.status == 'completed' %}bg-success{% elif job.status == 'in_progress' %}bg-warning{% elif job.status == 'expired' %}bg-danger{% else %}bg-secondary{% endif %}">
                                    {{ job.status }}
                                </span>
                            </td>
                            <td>{{ job.priority }}</td>
                            <td>{{ job.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                            <td>{{ job.assigned_to or 'None' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            {% if total_pages > 1 %}
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                        <a class="page-link" href="?page={{ current_page - 1 }}" {% if current_page == 1 %}tabindex="-1"{% endif %}>Previous</a>
                    </li>
                    
                    {% for p in range(max(1, current_page - 2), min(total_pages + 1, current_page + 3)) %}
                    <li class="page-item {% if p == current_page %}active{% endif %}">
                        <a class="page-link" href="?page={{ p }}">{{ p }}</a>
                    </li>
                    {% endfor %}
                    
                    <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                        <a class="page-link" href="?page={{ current_page + 1 }}" {% if current_page == total_pages %}tabindex="-1"{% endif %}>Next</a>
                    </li>
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        $('#jobsTable').DataTable({
            order: [[0, 'desc']],
            pageLength: {{ per_page }},
            searching: true,
            info: true,
            paging: false  // Disable DataTables pagination since we're using our own
        });
    });
</script>
{% endblock %} 